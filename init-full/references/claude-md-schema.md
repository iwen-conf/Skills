# CLAUDE.md 结构规范

> 定义 arc:init 生成的三级 CLAUDE.md 文件的必需章节、顺序和格式约定。

## 层级类型

| 层级 | 文件位置 | 适用场景 |
|------|---------|---------|
| 根级 (Root) | `<workspace>/CLAUDE.md` | 工作空间或独立项目的最顶层 |
| 分组级 (Group) | `<workspace>/<group>/CLAUDE.md` | 按语言/功能分组的中间目录 |
| 模块级 (Module) | `<workspace>/<group>/<module>/CLAUDE.md` | 独立项目/包/服务 |

---

## 根级 CLAUDE.md

### 必需章节（按此顺序）

#### 1. 标题 + 副标题

```markdown
# CLAUDE.md

This file provides guidance to Claude Code (claude.ai/code) when working with code in this repository.
```

#### 2. 变更记录 (Changelog)

```markdown
## 变更记录 (Changelog)

| 时间 | 操作 |
|------|------|
| 2026-02-24T10:00:00 | arc:init 多Agent协作生成 |
```

#### 3. 项目愿景

1 段话概括项目的定位、目标、技术方向。

#### 4. 架构总览

顶级目录表格：

```markdown
## 架构总览

| 顶级目录 | 定位 | 主要语言 | 子项目数 |
|---------|------|---------|---------|
| `GoProjects/` | Go 语言项目集合 | Go | 5 |
```

#### 5. 模块结构图

Mermaid `graph TD`，含 `click` 链接到子级 CLAUDE.md：

```markdown
## 模块结构图

​```mermaid
graph TD
    ROOT["项目名<br/>一句话描述"] --> MOD1["模块1"]
    ROOT --> MOD2["模块2"]

    click MOD1 "./mod1/CLAUDE.md" "查看模块1文档"
    click MOD2 "./mod2/CLAUDE.md" "查看模块2文档"
​```
```

#### 6. 模块索引

详细表格，每行一个模块/子项目：

```markdown
## 模块索引

| 模块路径 | 语言 | 一句话职责 | 成熟度 |
|---------|------|-----------|--------|
| `mod1/` | Go 1.24 | 用户认证服务 | 稳定 |
```

#### 7. 运行与开发

包含环境依赖表 + 各模块的快速启动命令：

```markdown
## 运行与开发

### 环境依赖

| 工具 | 版本要求 | 用途 |
|------|---------|------|
| Go | >= 1.24 | 后端项目 |

### 快速启动参考

各项目的具体启动命令请参考对应目录下的 CLAUDE.md。
```

#### 8. 测试策略

按分组列出测试覆盖情况：

```markdown
## 测试策略

| 分组 | 测试覆盖情况 |
|------|------------|
| GoProjects | utils-pkg 每个子包完整测试 + fuzz |
```

#### 9. 编码规范

按语言/框架分列：

```markdown
## 编码规范

- **Go**: 标准项目布局, gofmt/go vet/staticcheck
- **TypeScript**: ESLint + Prettier, strict 模式
```

#### 10. AI 使用指引

面向 AI agent 的注意事项（编号列表）：

```markdown
## AI 使用指引

1. 每个子项目是独立的 Git 仓库，修改前确认当前路径。
2. fork 项目的自定义代码在特定目录中。
```

#### 11. 跨项目依赖关系

文本或 mermaid 图展示项目间依赖：

```markdown
### 跨项目依赖关系

​```
utils-pkg (v0.2.1+)
  └── cloudmaze/backend (jwt, 工具函数)
​```
```

---

## 分组级 CLAUDE.md

### 必需章节（按此顺序）

1. **面包屑导航** — `[根目录](../CLAUDE.md) > **分组名**`（单独一行，紧贴标题前）
2. **标题** — `# <分组名>`
3. **变更记录** — 同根级
4. **项目愿景** — 分组范围的 1 段话概括
5. **架构总览** — 该分组下的子项目/模块概览
6. **模块结构图** — mermaid `graph TD` + `click` 链接
7. **模块索引** — 子项目/模块的详细表格
8. **运行与开发** — 各子项目的构建/启动命令
9. **测试策略** — 各子项目的测试覆盖
10. **编码规范** — 分组范围的语言/框架规范
11. **AI 使用指引** — 分组范围的 AI 注意事项

---

## 模块级 CLAUDE.md

### 必需章节（按此顺序）

1. **面包屑导航** — `[根目录](../../CLAUDE.md) > [分组名](../CLAUDE.md) > **模块名**`
2. **标题** — `# <模块名> -- <一句话描述>`
3. **变更记录** — 同根级
4. **模块职责** — 1-3 段话描述模块的核心功能和定位
5. **入口与启动** — 入口文件、启动命令、配置来源
6. **对外接口** — API 路由表（REST/GraphQL/WebSocket）

```markdown
## 对外接口

### REST API

| 路由组 | 路径前缀 | 认证 | 控制器 |
|--------|---------|------|--------|
| 认证 | `/v1/auth/` | 否 | `auth.go` |
```

7. **关键依赖** — 核心外部依赖表

```markdown
## 关键依赖

| 依赖 | 版本 | 用途 |
|------|------|------|
| gin | v1.9 | HTTP 框架 |
```

8. **数据模型** — ER 关系描述或表结构概览
9. **架构图** — mermaid 内部结构图
10. **测试与质量** — 测试框架、覆盖率、运行命令
11. **关联文件清单** — 重要文件列表及其职责

```markdown
## 关联文件清单

| 文件 | 职责 |
|------|------|
| `main.go` | 入口，依赖注入 |
| `wire.go` | 手动依赖注入 |
```

---

## 通用格式约定

### Mermaid 约定

- 使用 `graph TD`（自顶向下）
- 节点标签格式：`"名称<br/>一句话描述"`
- `click` 指令指向子级 CLAUDE.md 相对路径
- 单图最多 50 个节点；超出时按模块拆分

### 表格约定

- 表头、分隔行、数据行列数必须一致
- 路径和代码用反引号包裹
- 分隔行每列为 `------`（左对齐）

### 面包屑约定

- 根级：无面包屑
- 分组级：`[根目录](../CLAUDE.md) > **分组名**`
- 模块级：`[根目录](../../CLAUDE.md) > [分组名](../CLAUDE.md) > **模块名**`
- 深层模块：根据实际层级调整相对路径

### 成熟度枚举值

| 值 | 含义 |
|------|------|
| 实验 | 学习/实验项目，非生产用途 |
| 开发中 | 积极开发，未达到稳定状态 |
| 可用 | 基本功能完整，可在受控环境使用 |
| 稳定 | 功能完整，有测试覆盖，生产可用 |
| fork | 上游项目的 fork，含自定义修改 |
| 第三方 | 第三方项目的本地部署/配置 |
| 配置 | 纯配置文件，无代码逻辑 |

### 变更记录格式

时间戳使用 ISO 8601 格式：`YYYY-MM-DDTHH:mm:ss`。操作列简要描述本次变更内容，如：

- `arc:init 多Agent协作生成`
- `增量更新：补充 <模块> 详细信息`
- `修正 <模块> 职责描述，更新覆盖率`
